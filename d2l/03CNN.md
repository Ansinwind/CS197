# 卷积



## 全连接层 到 卷积

### 两个原则

- 平移不变性
- 局部性

### 二维全连接层

- 将输入和输出变形为矩阵

- 将权重变形为4D张量

  
  $$
  h_{ij}=\sum_{k,l}w_{i,j,k,l}x_{k,l}=\sum_{a,b}v_{i,j,a,b}x_{i+a,j+b}
  $$

- V是W的重新索引

### 套用原则之后

#### 平移不变性：

- x的平移导致h的平移
- v不应该依赖于ij
- $v_{i,j,a,b}=v_{a,b}$

二维卷积（数学上是 二维交叉相关）

#### 局部性：

- 评估
  $h_{ij}$
  不应该用远离
  $x_{ij}$
  的参数
- 当大于某个距离的时候
  $v_{a,b}=0$



## 卷积层

### 卷积计算

$Y_{size}=(n_h-k_h+1)\cdot(n_w-k_w+1)$



### 填充和步幅

都是卷积层的超参数

#### 填充

在输入周围增加额外的行列

$Y_{size}=(n_h-k_h+p_h+1)\cdot(n_w-k_w+p_w+1)$

通常取
$p_h=k_h-1,p_w=k_w-1$ 
输出形状不变

#### 步幅

行 / 列 的滑动步长

$Y_{size}=\lfloor(n_h-k_h+p_h+s_h)/s_h\rfloor\cdot\lfloor(n_w-k_w+p_w+s_w)/s_w\rfloor$

$Y_{size}=\lfloor(n_h-+s_h-1)/s_h\rfloor\cdot\lfloor(n_w+s_w-1)/s_w\rfloor$

如果输入高度和宽度可以被步幅整除

$Y_{size}=n_h/s_h\cdot n_w/s_w$



### 通道数

每个输出通道可以识别特定模式

输入通道核识别并组合输入中的模式

#### 多输入

彩色图像可能有RGB三个通道

每个通道都有一个卷积核，结果是所有通道卷积结果的和

#### 多输出

可以有多个三维卷积核，每个核生成一个输出通道

$$
X: c_i \times n_h\times n_w
\\
W:c_o\times c_i\times k_h\times k_w
\\
B:c_o\times c_i
\\
Y:c_o\times m_h\times m_w
\\
O(c_ic_ok_hk_wm_hm_w)
$$

#### 1×1卷积层

不识别空间模式，只是融合通道



- 输出通道数是卷积层的超参数
- 每个输入通道有独立的二维卷积核，所有通道结果相加得到一个输出通道结果
- 每个输出通道有独立的三位卷积核



## 池化层

积对位置敏感 我们需要一定程度的平移不变性

缓解卷积层对位置的敏感性，同样有窗口大小、填充和步幅作为超参数

### 例子 

#### 二维最大池化

滑动窗口但是没有卷积计算

比如在卷积基础上做最大池化 可容像素移位

#### 平均池化层



最大输出最强信号 平均输出平均信号



### 填充、步幅和多通道

- 都有填充和步幅
- 没有可学习的参数
- 在每个输入通道应用池化层以获得相应的输出通道
- 输出通道数=输入通道数


